define("wixCodeInit",["lodash","coreUtils","experiment","platformInit","host-platform-api"],function(e,t,r,n,o){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1357)}({0:function(t,r){t.exports=e},1:function(e,r){e.exports=t},1357:function(e,t,r){var n,o;n=[r(1358),r(1361),r(33)],void 0===(o=function(e,t,r){"use strict";return{getAppApi:e.getApi,initMainR:t,appsUtils:r.appsUtils,specMapUtils:r.specMapUtils,registerDeps:r.registerDeps}}.apply(t,n))||(e.exports=o)},1358:function(e,t,r){var n,o;n=[r(0),r(33),r(1),r(1359),r(1360),r(64)],void 0===(o=function(e,t,r,n,o,i){"use strict";var a=r.urlUtils,s=a.parseUrl,d=a.isQueryParamOn;var p=function(t){var r=[];return e(t).filter("controllerScriptMap").forEach(function(t){e.forEach(t.controllerScriptMap,function(e,n){r.push({id:n,url:e,appDefinitionId:t.id,isControllerScript:!0})})}),r};function c(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments[2],i=!!t.publicModel,a="undefined"!=typeof window&&!window.clientSideRender,c="undefined"==typeof window||window.isPseudoWindow,l=t.wixBiSession,f=l.viewerSessionId,m=l.visitorId,g=l.initialTimestamp,w=l.initialRequestTimestamp,v=l.siteMemberId,S=l.random,M=l.coin,x=l.pn,y=l.requestId,b=t.rendererModel,h=b.metaSiteId,I=b.userId,C=s(n.currentUrl);n.applications=n.applications||[];var A,P=p(n.applications),U=n.applications.concat(P),O={biSessionData:{metaSiteId:h,viewerSessionId:f,visitorId:m,siteMemberId:v,requestId:y,ownerId:I,pageLoadStart:g,networkPageLoadStart:w,pageNumber:x,random:S,coin:M,muteBi:d(C,"isqa")||d(C,"suppressbi"),sampleRatioState:e.get(C,"query.sampleratio")},deviceType:n.isMobileView?"mobile":"desktop",renderCycle:a&&!c?2:1,renderingEnv:c?"backend":"browser",userWarmup:t.userWarmup,locale:t.rendererModel.locale,namespacesSdkSource:n.namespacesSdkSource,externalComponentsSource:n.externalComponentsSource,wixCodeNamespacesAndElementorySupportSource:n.wixCodeNamespacesAndElementorySupportSource,wixCodeViewerAppSource:n.wixCodeViewerAppSource,openExperiments:(A=t.rendererModel.runningExperiments,e.reduce(A,function(e,t,r){return"new"===t&&e.push(r),e},[])),applications:JSON.stringify(U),csrfToken:r.cookieUtils.getCookie("XSRF-TOKEN"),isDebug:n.isDebug};return O=u(t)?e.merge(O,{compId:"wixCode_"+o.appDefinitionId,viewMode:i?"site":"preview"}):e.merge(O,{viewMode:i?"site":t.renderFlags.componentViewMode||"preview"})}function u(t){var r=t.rendererModel.clientSpecMap.toJS?t.rendererModel.clientSpecMap.toJS():t.rendererModel.clientSpecMap;return!!t.rendererModel.wixCodeModel&&e.some(r,{type:"siteextension"})}return{getApi:function(){var e=[],a=[],s=t.messageProxy.get(),d=!1,p=!0,l=null,f=null,m=null,g=void 0,w=void 0;return{init:function(a,p){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!d){l.applications=l.applications||[];var f=l.applications.length>0;if(u(a)){var m=t.specMapUtils.getAppSpec(p),v=n.buildUrl(a,m,l);g=o.getIFrameForApp(v,m),w=c(a,l,m)}else{if(!f)return;var S=n.buildStaticUrl(a,l);g=o.getIFrameForApp(S,{}),w=c(a,l)}var M=function(t,r){var n;o.isIFrameEvent(t,r)&&("PLATFORM_IFRAME"!==(n=r.data).intent&&"WIX_CODE"!==n.intent||"wix_code_iframe_initialized"!==n.type||t.contentWindow.postMessage(i.messageBuilder.setBootstrapParametersMessage(w),"*"),function(e){return("PLATFORM_IFRAME"===e.intent||"WIX_CODE"===e.intent)&&"wix_code_iframe_loaded"===e.type}(r.data)&&s.setMessageHandler(function(e){t.contentWindow.postMessage(e,"*")}),e.forEach(function(e){e(r.data)}))}.bind(null,g);window.addEventListener("message",M,!1),function(e){function t(){var t=window.document.body;t.insertBefore(e,t.firstChild),r.loggingUtils.performance.mark("platform-iframe-added-to-dom")}"loading"!==window.document.readyState?t():window.document.addEventListener("DOMContentLoaded",function(){t()})}(g),d=!0}},destroyAppsContainer:function(){g&&(g.parentNode.removeChild(g),d=!1,s=t.messageProxy.get(),g=void 0)},sendMessage:function(e){e&&s.sendOrHoldMessage(function(e){return a.reduce(function(e,t){return t(e)},e)}(e))},registerMessageHandler:function(t){e.push(t)},registerMessageModifier:function(e){a.push(e)},unregisterMessageHandler:function(t){var r=e.indexOf(t);-1!==r&&e.splice(r,1)},preLoadWidgets:function(e,r){!l&&u(e)&&t.widgetsPreLoader.asyncGetPreLoadMessage(e,r,function(e){p&&!l&&(l=e,s.sendOrHoldMessage(l))})},preLoadUserCode:function(e,r){(!f&&u(e)||t.appsUtils.getAppsBaseInfo({clientSpecMap:e.rendererModel.clientSpecMap,serviceTopology:e.serviceTopology,rendererModel:e.rendererModel}))&&t.widgetsPreLoader.asyncGetPreLoadUserCodeMessage(e,r,function(e){f||(f=e,s.sendOrHoldMessage(f))})},preInitWidgets:function(e,r){!m&&u(e)&&t.widgetsPreLoader.asyncGetPreInitMessage(e,r,function(e){m||(m=e,s.sendOrHoldMessage(m))})},isAppInitiated:function(){return d},getAppsIframe:function(){return g}}}}}.apply(t,n))||(e.exports=o)},1359:function(e,t,r){var n,o;n=[r(1)],void 0===(o=function(e){"use strict";function t(){for(var e=arguments[0],t=1;t<arguments.length;++t)e=e.replace(/\/$/,"")+"/"+arguments[t].replace(/^\//,"");return e}function r(e,t){var r,n=e.serviceTopology,o=(r=e.santaBase,/^https?:\/\/localhost(:[0-9]+)?\/?$/.test(r)||function(e){return/^https?:\/\/s3.amazonaws.com\/integration-tests-statics\/(.+)\/SNAPSHOT\/santa?$/.test(e)}(e.santaBase)?n.scriptsLocationMap.santa:e.santaBase);return o=function(e,t){var r=e.lastIndexOf("/");return/^\d+\.\d+\.\d+$/.test(t)?e.substring(0,r+1)+t:e}(o,t),/(.*\/services\/)?(.*)/.exec(o)[2]}function n(){return e.wSpy.wSpyParam?"?wspy="+e.wSpy.wSpyParam:""}function o(){if("function"!=typeof URLSearchParams&&"undefined"!=typeof window)return!1;var e=void 0;try{e=window.parent.location.search}catch(t){e=""}return(new URLSearchParams(e).get("debug")||"").includes("localWorker")}return{buildUrl:function(e,i){return function(e,n,i,a){if(o())return"//localhost/node_modules/santa-wix-code/"+(i.useWixCodeFallback?"fallback.html":"index.html");var s=a?"pub":"dev",d="//"+n.instanceId+"."+s+".",p=e.serviceTopology.wixCloudBaseDomain,c="node_modules/santa-wix-code/"+(i.useWixCodeFallback?"fallback.html":"index.html");return d+t(p,"_partials",r(e,i.runtimeSource),c)}(e,i,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},!!e.publicModel)+n()},buildStaticUrl:function(e){return function(e,n){if(o())return"//localhost/node_modules/santa-wix-code/"+(n.useWixCodeFallback?"fallback.html":"index.html");var i=r(e,n.runtimeSource),a="node_modules/santa-wix-code/"+(n.useWixCodeFallback?"fallback.html":"index.html");return t(e.publicModel?"/":"//editor."+e.serviceTopology.serverName+"/","_partials",i,a)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})+n()}}}.apply(t,n))||(e.exports=o)},1360:function(e,t,r){var n,o;n=[r(0)],void 0===(o=function(e){"use strict";return{getIFrameForApp:function(t,r){var n=window.document.createElement("iframe");return n.style.cssText="position: fixed; left: 0; right: 0; top: 0; bottom: 0; width: 1px; height: 1px; background: transparent; border: 0",n.tabIndex=-1,n.setAttribute("aria-hidden","true"),n.src=t,e.get(r,"applicationId")&&e.get(r,"appDefinitionId")&&(n.setAttribute("data-app-id",r.applicationId),n.setAttribute("data-app-definition-id",r.appDefinitionId)),n},isIFrameEvent:function(e,t){return t.source===e.contentWindow}}}.apply(t,n))||(e.exports=o)},1361:function(e,t,r){var n,o;n=[r(0),r(33),r(8)],void 0===(o=function(e,t,r){"use strict";return function(n){var o=n.appApi,i=n.siteModel,a=n.isMobileView,s=n.queryUtil,d=n.currentUrl,p=n.isBot,c=!e.isEmpty(s.getParameterByName("debug"));d=d||window.document.location.href;var u,l=t.wixCodeUrlUtils.buildScriptsSources(i.serviceTopology,{isDebug:c}),f=l.namespacesSdkSource,m=l.externalComponentsSource,g=l.wixCodeNamespacesAndElementorySupportSource,w=l.wixCodeViewerAppSource,v=(y=s.getParameterByName("useWixCodeFallback"),(!r.isOpen("sv_wixCodeForceWorkerForSEO",i)||!window.Worker)&&"false"!==y&&("true"===y||!window.Worker||p)),S={isMobileView:a,namespacesSdkSource:f,externalComponentsSource:m,wixCodeNamespacesAndElementorySupportSource:g,wixCodeViewerAppSource:w,runtimeSource:s.getParameterByName("WixCodeRuntimeSource"),ReactSource:s.getParameterByName("ReactSource"),useWixCodeFallback:v,isDebug:c,currentUrl:d},M=s.getParameterByName("viewerPlatformAppSources"),x=s.getParameterByName("controllersUrlOverride");var y;S.applications=t.appsUtils.getAppsBaseInfo({rendererModel:i.rendererModel,clientSpecMap:i.rendererModel.clientSpecMap,serviceTopology:i.serviceTopology,viewerPlatformAppSources:M,currentUrl:d,santaBase:i.santaBase,controllersUrlOverride:x}),u=i.rendererModel.clientSpecMap,o.init(i,u,S),function(e){return t.specMapUtils.getAppSpec(e)||S.applications.length}(u)&&(r.isOpen("sv_moveWixCodeToViewerApp",i)||o.preLoadUserCode(i,d),i.publicModel&&o.preLoadWidgets(i,d))}}.apply(t,n))||(e.exports=o)},33:function(e,t){e.exports=n},64:function(e,t){e.exports=o},8:function(e,t){e.exports=r}})});
//# sourceMappingURL=wixCodeInit.min.js.map